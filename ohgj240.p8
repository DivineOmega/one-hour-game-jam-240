pico-8 cartridge // http://www.pico-8.com
version 18
__lua__
objs = {}

score = 0
high_score = 0
game_over = false

spawn_cooldown = 20
spawn_cooldown_max = 50

function _init()
 sfx(3)

 score = 0
 add(objs, create_player())
end

function _update()
 if (score > high_score) then
  high_score = score
 end

 if (game_over) then
  if btnp(5) then
   game_over = false
   objs = {}
   money = 0
   _init()
  end
  return
 end

 for obj in all(objs) do
  obj.update()
 end
 
 if (spawn_cooldown <= 0) then
  local x = rnd(128)
  local y = - 10
  local angle_offset = -0.05 + rnd(0.1)
  add(objs, 
   create_enemy(x, y, angle_offset)
  )
  spawn_cooldown = spawn_cooldown_max
 else
  spawn_cooldown -= 1
 end
 
end

function _draw()
 rectfill(0, 0, 128, 128, 0)
 
 for obj in all(objs) do
  obj.draw()
 end
 
 rect(0, 0, 127, 127, 5)
 
 print("score: "..score.."  high: "..high_score, 30, 5, 7)
 
  if (game_over) then
   print ("game over!", 40, 55, 7)
   print ("press x to restart", 25, 65, 7)
 end

end
-->8

 function spr_r(s,x,y,a,w,h)
  sw=(w or 1)*8
  sh=(h or 1)*8
  sx=(s%8)*8
  sy=flr(s/8)*8
  x0=flr(0.5*sw)
  y0=flr(0.5*sh)
  sa=sin(a)
  ca=cos(a)
  for ix=0,sw-1 do
   for iy=0,sh-1 do
    dx=ix-x0
    dy=iy-y0
    xx=flr(dx*ca-dy*sa+x0)
    yy=flr(dx*sa+dy*ca+y0)
    if (xx>=0 and xx<sw and yy>=0 and yy<=sh) then
     pset(x+ix,y+iy,sget(sx+xx,sy+yy))
    end
   end
  end
 end
-->8
function create_player()
 local obj = {}
 obj.type = "player"
 obj.sprite = 0
 obj.x = 64
 obj.y = 64
 obj.w = 8
 obj.h = 8
 obj.angle = 0.25
 obj.speed = -1
 obj.cooldown_max = 10
 obj.cooldown = 0
 
 obj.draw = function()
  spr_r(obj.sprite, obj.x, obj.y, -obj.angle+0.25)
 end
 
 obj.update = function()
  obj.x += obj.speed * cos(obj.angle)
  obj.y += obj.speed * sin(obj.angle)
    
  if (obj.cooldown > 0) then
   obj.cooldown = obj.cooldown - 1
  end
    
  if (btn(2) and obj.cooldown <= 0) then
   local bullet = 
    create_player_bullet(
     obj.x,
     obj.y,
     obj.angle-1
    )
   add(objs, bullet)
   obj.cooldown = obj.cooldown_max
   sfx(0)
  end
  
  if (btn(0)) then
   obj.angle += 0.02
  end
  
  if (btn(1)) then
   obj.angle -= 0.02
  end
    
  if (obj.x <= 0) then
   obj.x = 127
  end
  
  if (obj.y <= 0) then
   obj.y = 127
  end
  
  if (obj.x >= 128) then
   obj.x = 1
  end
  
  if (obj.y >= 128) then
   obj.y = 1
  end
  
 end
 
 return obj
end
-->8
function create_player_bullet(x, y, angle)
 local obj = {}
 obj.type = "player_bullet"
 obj.sprite = 2
 obj.x = x
 obj.y = y
 obj.w = 3
 obj.h = 3
 obj.angle = angle
 obj.speed = 3
 
 obj.draw = function()
  spr(obj.sprite, obj.x, obj.y)
 end
 
 obj.update = function()
  obj.x += obj.speed * cos(obj.angle)
  obj.y += obj.speed * sin(obj.angle)
    
  if (obj.x <= 0) then
   obj.destroy()
  end
  
  if (obj.y <= 0) then
   obj.destroy()
  end
  
  if (obj.x >= 128) then
   obj.destroy()
  end
  
  if (obj.y >= 128) then
   obj.destroy()
  end
  
 end
 
 obj.destroy = function()
  del(objs, obj)
 end
 
 return obj
end
-->8
function create_enemy(x, y, angle_offset)
 local obj = {}
 obj.type = "enemy"
 obj.sprite = 4
 obj.x = x
 obj.y = y
 obj.w = 8
 obj.h = 8
 obj.angle = -0.25 + angle_offset
 obj.speed = 1
 obj.cooldown_max = 10
 obj.cooldown = 0
 
 obj.draw = function()
  spr_r(obj.sprite, obj.x, obj.y, -obj.angle-0.25)
 end
 
 obj.update = function()
  obj.x += obj.speed * cos(obj.angle)
  obj.y += obj.speed * sin(obj.angle)
  
  if (obj.y > 128) then
   del(objs, obj)
   return
  end
  
  for obj2 in all(objs) do
   if (obj2.type == "player_bullet") then
    if (collision(obj, obj2)) then
     del(objs, obj)
     del(objs, obj2)
     sfx(1)
     score += 1
     return
    end
   end
   if (obj2.type == "player") then
    if (collision(obj, obj2)) then
     sfx(2)
     game_over = true
    end
   end
  end
  
 end
 
 return obj
end
-->8
function collision(ent1, ent2)
 if (ent1.x <= ent2.x + ent2.w and
       ent1.x + ent1.w >= ent2.x and
       ent1.y <= ent2.y + ent2.h and
       ent1.h + ent1.y >= ent2.y) then
  return true
 else
 	return false
 end
end
__gfx__
00000000000000000700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000007770000000000000006868000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000700000000000000068989800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
08077080000000000000000000000000089898600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07077070000000000000000000000000088888800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07077070000000000000000000000000082002800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00777700000000000000000000000000080000800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__label__
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000007700770077077707770000000007770000000007070777007707070000000007770000000000000000000000000000005
50000000000000000000000000000070007000707070707000070000007070000000007070070070007070070000007070000000000000000000000000000005
50000000000000000000000000000077707000707077007700000000007070000000007770070070007770000000007070000000000000000000068000000005
50000000000000000000000000000000707000707070707000070000007070000000007070070070707070070000007070000000000000000006889800000005
50000000000000000000000000000077000770770070707770000000007770000000007070777077707070000000007770000000000000000068998600000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000089888880000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008880280000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008200080000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000007700000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000007700000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000807708000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000707707000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000707707000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000077770000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555

__sfx__
010400001715017150131501715000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
010400001025011350103500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
010b00001745013450104500c45000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
010800001105013050150501705015050170500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
